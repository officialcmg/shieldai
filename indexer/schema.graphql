# RegisteredUser - tracks users who registered in UserRegistry
type RegisteredUser {
  id: ID! # User address (lowercase)
  address: String! @index
  registeredAt: BigInt!
  isActive: Boolean! @index # false if user unregistered
}

# Approval - ALL ERC20 approval events (not just registered users)
type Approval {
  id: ID! # chainId_blockNumber_logIndex
  owner: String! @index
  tokenAddress: String! @index
  spender: String! @index
  amount: String!
  isRevocation: Boolean! @index # true if amount is 0 (revoked approval)
  timestamp: BigInt!
  blockNumber: BigInt!
}

# MonitoredApproval - Approvals from REGISTERED users only (sent to backend)
type MonitoredApproval {
  id: ID! # chainId_blockNumber_logIndex
  userAddress: String! @index
  tokenAddress: String! @index
  spender: String! @index
  amount: String!
  isRevocation: Boolean! @index # true if amount is 0 (revoked approval)
  timestamp: BigInt!
  blockNumber: BigInt!
  notifiedBackend: Boolean! # Did we successfully call the webhook?
}

# CurrentApproval - Latest approval state per (owner, tokenAddress, spender)
# This is the "current state" of approvals - gets UPDATED on each new approval event
type CurrentApproval {
  id: ID! # owner_tokenAddress_spender
  owner: String! @index
  tokenAddress: String! @index
  spender: String! @index
  amount: String! # Current approval amount
  isRevocation: Boolean! @index # true if latest event was amount = 0
  timestamp: BigInt! # When this state was last updated
  blockNumber: BigInt! # Block number of last update
  lastEventId: String! # Reference to the Approval event that caused this state
}
